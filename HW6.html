<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Read Only by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            window.MathJax = {
                tex: { inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['$$','$$'], ['\\[','\\]']] },
                svg: { fontCache: 'global' }
            };
        </script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
        <style>
        .controls { 
            background-color: #fff; 
            padding: 20px; 
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex; 
            gap: 25px;
            align-items: flex-end;
            justify-content: center;
            flex-wrap: wrap;
        }
        .controls div { 
            display: flex; 
            flex-direction: column; 
            flex-grow: 1;
            max-width: 150px;
        }
        .controls label { 
            font-weight: bold; 
            margin-bottom: 8px;
            font-size: 1em;
            color: #555; 
        }
        .controls input { 
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
            font-size: 1em;
        }
        .controls button { 
            padding: 12px 25px;
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 1.1em;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        .controls button:hover { 
            background-color: #0056b3; 
            transform: translateY(-2px);
        }
        .controls button.reset-zoom {
            background-color: #6c757d;
        }
        .controls button.reset-zoom:hover {
            background-color: #5a6268;
        }
        
        /* Contenitori per i grafici */
      /* Contenitori per i grafici (3 righe) */
            .chart-container-row1, .chart-container-row2, .chart-container-row3 { 
                display: flex; 
                width: 100%; 
                gap: 20px; 
            }
            .chart-container-row1 { height: 700px; } /* Riga 1 (Grafici 1 & 2) */
            .chart-container-row2 { height: 500px; margin-top: 20px; } /* Riga 2 (Grafico 3) */
            .chart-container-row3 { height: 600px; margin-top: 20px; } /* Riga 3 (Grafico 4) */

        /* Stili per i box dei grafici */
        .chart-box { 
            background: #fff; 
            padding: 20px;
            border-radius: 10px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
        }
        .main-chart { flex: 3; }
        .histogram { flex: 1; }
        .cumulative-chart { flex: 1; }
        .cumulative-histogram { flex: 1; } /* Ora occupa tutta la riga 3 */

    </style>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<section id="header">
				<header>
					<span class="image avatar"><img src="images/avatar.jpg" alt="" /></span>
					<h1 id="logo"><a href="#">Alessio Mareschi</a></h1>
					<p><a href="index.html">Home</a></p>
					
				</header>
				
				<footer>
					<ul class="icons">
						<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
					</ul>
				</footer>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

						<!-- One -->
							<section id="one">
								<div class="image main" data-position="center">
									<img src="images/HW1_image.png" alt="" />
								</div>
								<div class="container">
									<header class="major">
										<h2>Homework 6</h2>
										<p>Online Mean & Variance — Simple Recurrences, Robust Algorithms</p>
									</header>
								</div>
							</section>

							<!-- Two -->
							<section id="two">
                                
								<div class="container">

                                    <h2>Online algorithms for mean and variance</h2>

                <p>This page contains concise derivations of the recurrence relations for the arithmetic mean and variance and a numerically stable one-pass implementation (Welford's algorithm). The implementations update statistics incrementally (online) as new data arrives, avoiding large memory usage and numerical instability.</p>

                <h3>Recurrence for the arithmetic mean</h3>
                <p>Let $\mu_{n-1}$ be the mean after $n-1$ samples and $x_n$ be the new sample. The new mean $\mu_n$ is:</p>
                <p>$$
                \mu_n = \frac{1}{n}\sum_{i=1}^{n} x_i = \frac{1}{n}\left(\sum_{i=1}^{n-1} x_i + x_n\right) = \frac{(n-1)\mu_{n-1} + x_n}{n}
                $$
                Rearranging gives the common incremental form:
                $$
                \mu_n = \mu_{n-1} + \frac{x_n - \mu_{n-1}}{n}.
                $$

                <h3>Recurrence for variance (Welford's derivation)</h3>
                <p>We want a one-pass, stable recurrence for the variance. Define the running second central moment $M2_n = \sum_{i=1}^n (x_i - \mu_n)^2$. Using algebra one can show the update:</p>
                <p>When adding $x_n$ we set $\delta = x_n - \mu_{n-1}$ and the updated mean is $\mu_n = \mu_{n-1} + \delta/n$. Then:</p>
                <p>$$
                M2_n = M2_{n-1} + (x_n - \mu_{n-1})(x_n - \mu_n) = M2_{n-1} + \delta\,(\delta - \delta/n) = M2_{n-1} + \delta\,(x_n - \mu_n).
                $$
                <p>The population variance is $\sigma^2 = M2_n / n$, and the (unbiased) sample variance is $s^2 = M2_n / (n-1)$ for $n>1$.</p>

                <h3>Why this is numerically stable</h3>
                <p>Welford's update keeps differences $\delta$ (which are small relative to the mean) rather than subtracting two large sums. This avoids catastrophic cancellation and overflow compared to naive two-pass or sum-of-squares batch formulas.</p>

                <h3>Interactive demonstration and verification</h3>
                <p>Below is an interactive demo that shows step-by-step how the <code>OnlineStats</code> class updates the mean and variance (Welford's algorithm). The demo compares the online result with a batch computation (used only for verification) and highlights any discrepancies due to numerical error.</p>

                <div id="demo">
                    <div class="demo-controls">
                        <button id="run-demo">Run demo (synthetic data)</button>
                        <button id="run-random">Add random value</button>
                        <button id="reset">Reset</button>
                        <label style="margin-left:10px"><input type="checkbox" id="show-batch" checked> Show batch comparison</label>
                    </div>
                    <div id="demo-explanation" style="margin-top:0.5em; color: rgb(0, 0, 0);">
                        <strong>Quick explanation:</strong>
                        <ul>
                            <li>On each new value we update the count <code>n</code>, the mean $\mu_n$ and the accumulator $M2_n$ used to compute the variance.</li>
                            <li>The population variance is $\sigma^2 = M2_n / n$, the (unbiased) sample variance is $s^2 = M2_n / (n-1)$ for $n>1$.</li>
                            <li>The batch comparison is shown only to verify that the online algorithm produces the same result within a numerical tolerance.</li>
                        </ul>
                    </div>
                    <div id="results"></div>
                </div>
            </section>
            <script>
                // OnlineStats: Welford's algorithm
                class OnlineStats {
                    constructor() {
                        this.n = 0;
                        this.mean = 0.0;
                        this.M2 = 0.0; // sum of squared deviations
                    }
                    add(x) {
                        this.n += 1;
                        const delta = x - this.mean;
                        this.mean += delta / this.n;
                        const delta2 = x - this.mean;
                        this.M2 += delta * delta2;
                    }
                    count() { return this.n; }
                    getMean() { return this.n > 0 ? this.mean : NaN; }
                    // population variance
                    getVariancePopulation() { return this.n > 0 ? this.M2 / this.n : NaN; }
                    // sample variance (unbiased)
                    getVarianceSample() { return this.n > 1 ? this.M2 / (this.n - 1) : NaN; }
                    reset() { this.n = 0; this.mean = 0.0; this.M2 = 0.0; }
                }

                // Small helper: compute batch stats for verification only
                function batchStats(arr) {
                    const n = arr.length;
                    if (n === 0) return {mean: NaN, varPop: NaN, varSample: NaN};
                    let sum = 0, sumSq = 0;
                    for (const x of arr) { sum += x; sumSq += x * x; }
                    const mean = sum / n;
                    // population variance using definition (exact for small n)
                    let s2 = 0;
                    for (const x of arr) { const d = x - mean; s2 += d * d; }
                    return {mean: mean, varPop: s2 / n, varSample: n>1 ? s2 / (n-1) : NaN};
                }

                // Demo runner (migliorata)
                (function(){
                    const runBtn = document.getElementById('run-demo');
                    const randBtn = document.getElementById('run-random');
                    const resetBtn = document.getElementById('reset');
                    const showBatchCheckbox = document.getElementById('show-batch');
                    const results = document.getElementById('results');

                    function clearResults() { results.innerHTML = ''; }

                    function renderTable(online, batch, showBatch) {
                        clearResults();
                        const table = document.createElement('table');
                        table.style.borderCollapse = 'collapse';
                        table.style.width = '100%';
                        const hdr = document.createElement('tr');
                        ['Item', 'Online', (showBatch ? 'Batch' : ''), 'Diff', 'Match'].forEach(h => {
                            if (!h) return;
                            const th = document.createElement('th'); th.textContent = h; th.style.border = '1px solid #ccc'; th.style.padding = '6px'; hdr.appendChild(th);
                        });
                        table.appendChild(hdr);

                        function row(name, onVal, batchVal) {
                            const tr = document.createElement('tr');
                            const tdName = document.createElement('td'); tdName.textContent = name; tdName.style.padding='6px'; tdName.style.border='1px solid #eee'; tr.appendChild(tdName);
                            const tdOn = document.createElement('td'); tdOn.textContent = String(onVal); tdOn.style.padding='6px'; tdOn.style.border='1px solid #eee'; tr.appendChild(tdOn);
                            if (showBatch) {
                                const tdB = document.createElement('td'); tdB.textContent = String(batchVal); tdB.style.padding='6px'; tdB.style.border='1px solid #eee'; tr.appendChild(tdB);
                            }
                            const diff = (isFinite(onVal) && isFinite(batchVal)) ? Math.abs(onVal - batchVal) : NaN;
                            const tdDiff = document.createElement('td'); tdDiff.textContent = isNaN(diff) ? '' : diff.toPrecision(6); tdDiff.style.padding='6px'; tdDiff.style.border='1px solid #eee'; tr.appendChild(tdDiff);
                            const tol = 1e-6 * Math.max(1, Math.abs(batchVal || 0));
                            const match = isFinite(diff) ? diff <= tol : (onVal===batchVal);
                            const tdMatch = document.createElement('td'); tdMatch.textContent = match ? '✓' : '✗'; tdMatch.style.padding='6px'; tdMatch.style.border='1px solid #eee'; tdMatch.style.color = match ? 'green' : 'red'; tr.appendChild(tdMatch);
                            return tr;
                        }

                        table.appendChild(row('Count (n)', online.count(), batch ? (batch._n || '') : ''));
                        table.appendChild(row('Mean', online.getMean(), batch.mean));
                        table.appendChild(row('Var (pop)', online.getVariancePopulation(), batch.varPop));
                        table.appendChild(row('Var (sample)', online.getVarianceSample(), batch.varSample));
                        results.appendChild(table);

                        // short textual explanation
                        const expl = document.createElement('div'); expl.style.marginTop='0.6em'; expl.style.color = 'black';
                        expl.innerHTML = '<strong>Interpretation:</strong> If all entries show "✓" then the online algorithm and the batch computation agree within numerical tolerance; any "✗" indicates discrepancies possibly caused by floating-point representation or extreme input cases.';
                        results.appendChild(expl);

                        // re-render MathJax (utile se qualche stringa contiene espressioni LaTeX dinamiche)
                        if (window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();
                    }

                    // helper to prepare batch object with a _n field for display
                    function batchFromArray(arr) {
                        const b = batchStats(arr);
                        b._n = arr.length;
                        return b;
                    }

                    // synthetic test dataset
                    function runSynthetic() {
                        // dataset designed to show numerical stability
                        const data = [1e8, 1e8+1, 1e8+2, 3, 4, 5, -1e8, 2, 2.5, 3.5, 4.5];
                        const online = new OnlineStats();
                        for (const x of data) online.add(x);
                        const batch = batchFromArray(data);
                        renderTable(online, batch, showBatchCheckbox.checked);
                        // store for incremental demo
                        window._demoOnline = online; window._demoData = data.slice();
                    }

                    runBtn.addEventListener('click', () => runSynthetic());

                    randBtn.addEventListener('click', () => {
                        let online = window._demoOnline; if (!online) { online = new OnlineStats(); window._demoOnline = online; window._demoData = []; }
                        const x = (Math.random()-0.5) * 200 - 50 + Math.sin(Date.now()%1000);
                        window._demoData.push(x); online.add(x);
                        const batch = batchFromArray(window._demoData);
                        renderTable(online, batch, showBatchCheckbox.checked);
                    });

                    resetBtn.addEventListener('click', () => { window._demoOnline = new OnlineStats(); window._demoData = []; clearResults(); });

                    // auto-run once
                    runSynthetic();
                })();
            </script>
                                    
                                    
    
                                    
									

									
									



								</div>


								


							</section>

						
						<!-- Three -->
							

						

						

					</div>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>